<%= content_for :fact_constituents do %>
  <div id="fact_constituents" class="card">

    <div id="fact_constituents-header" class="card-header">
      <button class="btn btn-link"
              type="button"
              data-toggle="collapse"
              data-target="#fact_constituents-collection"
              aria-expanded="true"
              aria-controls="fact_constituents-collection">
        <%= icon(:fact_constituent) %>
        &nbsp;
        <%= obj.count %>
        &nbsp;
        <%= FactConstituent.model_name.human(count: obj.count).capitalize %>
      </button>
    </div>

    <div id="fact_constituents-collection"
         class="collapse"
         aria-labeled-by="fact_constituents-header"
         data-parent="#attributes">
      <div class="card-body">

        <%# Actual index list goes here %>
        <div class="row">
          <div class="col">

            <ul class="list-unstyled">
              <% obj.each do |fact_constituent| %> 
                <%= tag.li(class: 'media mb-4', id: element_id(fact_constituent)) do %>

                  <%= tag.a(href: polymorphic_path([@world, fact_constituent.constituable])) do %>
                    <% if fact_constituent.constituable.image.attached? %>
                      <%=
                        tag.img(
                          src: attached_img_path(
                            fact_constituent.constituable.image,
                            { resize: "64x64^" }),
                          class: 'mr-3 q-media-img'
                        ) %>
                    <% else %>
                      <%= default_image(
                        fact_constituent.constituable,
                        'mr-3 q-media-img-default') %>
                    <% end %>
                  <% end %>

                  <%# Body %>
                  <div class="media-body">
                    <h5 class="mb-1">
                      <%= icon(fact_constituent.constituable) { fact_constituent.constituable.name } %>
                      <% unless fact_constituent.roles.empty? %>
                        <span class="small text-muted">(<%= fact_constituent.roles.join(', ') %>)</span><br />
                      <% end %>
                    </h5>
                    <div class="small">
                      <%= fact_constituent.constituable.description %><br />
                      <%= link_to(t('show'), polymorphic_path([@world, fact_constituent.constituable])) %>
                      <%= link_to(t('.edit_roles'), edit_world_fact_fact_constituent_path(@world, @fact, fact_constituent)) %>
                      <%= link_to(t('.remove_from_fact'), world_fact_fact_constituent_path(@world, @fact, fact_constituent),
                                  method: :delete, data: {confirm: t('.confirm_delete',
                                                                     constituent: fact_constituent.constituable.name)},
                                                                    title: 'destroy') %>
                  </div>
                  </div>

                <% end %>
              <% end %>
            </ul>

          </div> 
        </div>
        <%# Actual index list ends here %>

        <div class="row">
          <div class="col text-right">
            <%= link_to(
              icon(:new),
              new_world_fact_fact_constituent_path(@world, @fact)) %>
        </div>
        </div>

      </div>
    </div>

  </div>
<% end %>


